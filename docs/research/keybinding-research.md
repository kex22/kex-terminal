# 终端多路复用器快捷键设计调研

## 1. 现有工具快捷键模式对比

### tmux — 前缀键模式

- 默认前缀键 `Ctrl-b`，按下后松开，再按功能键
- 社区常见修改：改为 `Ctrl-a`（继承 screen 习惯）或 `Ctrl-Space`
- **优点**：不会和终端内程序的快捷键冲突
- **痛点**：
  - 操作链路长：前缀键 → 松开 → 功能键，三步才能完成一个操作
  - 新手难以记忆大量的单字母命令（`%` 水平分割、`"` 垂直分割，语义不明）
  - 前缀键本身占用了一个常用组合键

### Zellij — 模式切换 + 提示栏

- 采用类 vim 的模式系统：Normal / Pane / Tab / Resize / Scroll / Session 等模式
- 底部始终显示当前模式下可用的快捷键提示
- **优点**：
  - 可发现性极强，新手友好，不需要背快捷键
  - 每个模式下的键位简单（单键操作，如 Pane 模式下 `h/j/k/l` 切换方向）
  - 不需要前缀键
- **痛点**：
  - 模式太多（6+ 种），频繁切换模式本身成为负担
  - 熟练用户觉得提示栏浪费屏幕空间
  - 社区反馈：从 tmux 迁移过来的用户觉得"模式切换比前缀键更慢"

### WezTerm — 直接组合键

- 使用标准的修饰键组合：`Ctrl-Shift-Alt` + 功能键
- 不需要前缀键或模式切换
- **优点**：一步到位，操作最快
- **痛点**：
  - 组合键容易和终端内程序、系统快捷键冲突
  - 可用的组合键空间有限，功能多了容易记混

### Screen — 经典前缀键

- 前缀键 `Ctrl-a`，和 tmux 类似但更早
- 基本已被 tmux 取代，但 `Ctrl-a` 这个选择影响了整个社区

## 2. 社区主要观点总结

### 关于前缀键

- **支持方**：前缀键是必要的恶，它保证了和终端程序的隔离，避免快捷键冲突
- **反对方**：前缀键让每个操作多一步，累积起来严重影响效率
- **折中派**：前缀键可以接受，但默认键位选择很重要（`Ctrl-b` 太难按，`Ctrl-Space` 更好）

### 关于模式系统（Zellij 风格）

- **新手**普遍喜欢 Zellij 的提示栏，降低了学习门槛
- **老手**普遍觉得模式切换太频繁，不如 tmux 前缀键直接
- 核心矛盾：**可发现性 vs 操作效率**

### 关于直接组合键

- 大多数人认为这是最快的方式，但冲突问题无法根本解决
- 适合终端模拟器（WezTerm、Kitty），不太适合纯 CLI 工具（因为 CLI 工具无法拦截所有键位）

### 高频讨论的改进建议

1. **智能前缀键**：前缀键按住不松开直接按功能键（chord 模式），比"按下-松开-再按"更快
2. **渐进式学习**：默认显示提示，熟练后可关闭（Zellij 的思路但可选）
3. **语义化键位**：`s` = split, `n` = new, `k` = kill，而不是 tmux 的 `%`、`"` 这种符号
4. **vim 风格方向键**：`h/j/k/l` 导航几乎是社区共识
5. **可配置但默认好用**：默认键位应该开箱即用，不需要像 tmux 一样先写一堆配置

## 3. 对 kex-terminal 的启示

| 维度 | tmux | Zellij | 建议方向 |
|------|------|--------|----------|
| 学习曲线 | 陡峭 | 平缓 | 平缓，带提示 |
| 操作效率 | 中等 | 中等 | 高（chord 模式） |
| 键位冲突 | 低 | 低 | 低 |
| 可配置性 | 高 | 中 | 高，但默认好用 |
| 键位语义 | 差 | 好 | 好 |

### 推荐的三种方案

**方案 A：优化的前缀键 + 语义化键位**
- 保留前缀键机制（默认 `Ctrl-Space`），但支持 chord 模式（按住前缀键不松开）
- 功能键语义化：`s` split, `n` new, `k` kill, `h/j/k/l` 方向
- 优点：和终端程序隔离好，tmux 用户容易迁移
- 缺点：仍然需要前缀键

**方案 B：轻量模式系统**
- 只有两个模式：Normal（输入传递给终端）和 Command（kex 接管键盘）
- 用一个键切换模式（如 `Ctrl-Space`），Command 模式下单键操作
- 底部可选提示栏
- 优点：比 Zellij 简单，比 tmux 直观
- 缺点：仍有模式切换的心智负担

**方案 C：混合模式**
- 高频操作用直接组合键（`Ctrl-h/j/k/l` 切换 pane）
- 低频操作用前缀键（`Ctrl-Space` → `s` split）
- 优点：常用操作最快，不常用的也能覆盖
- 缺点：两套体系，用户需要记住哪些是直接键、哪些需要前缀

## 4. SSH 场景约束分析

许多用户通过 SSH 登录远程服务器后使用终端多路复用器，这对快捷键设计有重要影响：

- **Chord 模式（按住不松）不可靠**：终端协议传输按键事件，无法区分"按住"和"快速按下松开"
- **`Ctrl-Shift-*` 组合键**：大部分 SSH 客户端不传递
- **`Alt-*` 组合键**：部分终端转义为 `ESC + key`，行为不一致
- **`Ctrl-h`**：在很多终端中等同于 Backspace，不可用于导航
- **最可靠的键位**：`Ctrl-a` 到 `Ctrl-z`、普通单字符键、方向键

### SSH 约束下的方案评估

| 方案 | SSH 兼容性 | 说明 |
|------|-----------|------|
| A: 优化前缀键 | ⚠️ 中等 | chord 模式在 SSH 下失效，退化为普通前缀键 |
| B: 轻量模式 | ✅ 好 | 只需一个切换键 + 单键操作，全部 SSH 友好 |
| C: 混合模式 | ❌ 差 | 直接组合键在 SSH 下冲突多 |

## 5. 推荐：方案 B — 轻量模式系统

**推荐理由：**

1. SSH 友好：只需一个可靠的切换键（如 `Ctrl-a`），不依赖复杂组合键
2. Command 模式下全是单键操作（`s` split, `k` kill, `h/j/k/l` 方向），任何环境都能工作
3. 只有两个模式（Normal / Command），心智负担远小于 Zellij 的 6+ 模式
4. 提示栏可选，新手开着学习，熟练后关掉省空间
